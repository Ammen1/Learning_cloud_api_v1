# Render Deployment Guide

## Prerequisites

Before deploying to Render, ensure you have:

1. **Python 3.12.7** - Specified in `runtime.txt` and `.python-version`
2. **Node.js 18.x** - Specified in `package.json` and `.nvmrc`
3. **PostgreSQL Database** - Create a database in Render
4. **Redis** - Create a Redis instance in Render (optional but recommended)

## Environment Variables

Set the following environment variables in your Render dashboard:

### Required Variables

- `SECRET_KEY` - Django secret key (can be auto-generated by Render)
- `DEBUG` - Set to `False` for production
- `DATABASE_URL` - PostgreSQL connection string (auto-provided if using Render's PostgreSQL)
- `REDIS_URL` - Redis connection string (if using Redis)
- `ALLOWED_HOSTS` - Comma-separated list of allowed hosts (e.g., `your-app.onrender.com`)

### Optional Variables

- `AWS_ACCESS_KEY_ID` - For S3 storage (if using)
- `AWS_SECRET_ACCESS_KEY` - For S3 storage (if using)
- `AWS_STORAGE_BUCKET_NAME` - For S3 storage (if using)
- `USE_S3` - Set to `True` to enable S3 storage
- `CORS_ALLOWED_ORIGINS` - Comma-separated list of CORS origins

## Deployment Steps

### Option 1: Using render.yaml (Recommended)

1. The `render.yaml` file is already configured
2. In Render dashboard, create a new "Blueprint" and connect your repository
3. Render will automatically detect and use the `render.yaml` configuration

### Option 2: Manual Configuration

1. Create a new Web Service in Render
2. Connect your GitHub repository
3. Set the following:
   - **Environment**: Python 3
   - **Build Command**: `pip install --upgrade pip && pip install -r requirements.txt && python manage.py collectstatic --noinput`
   - **Start Command**: `gunicorn learning_cloud.wsgi:application --bind 0.0.0.0:$PORT`
   - **Python Version**: Set environment variable `PYTHON_VERSION=3.12.7`
   - **Node Version**: Set environment variable `NODE_VERSION=18.x`

## Fixing Common Issues

### Pillow Installation Error

If you see errors about Pillow, ensure:
- Python version is 3.12.7 (not 3.13.x)
- Requirements.txt has `Pillow==10.4.0` or higher
- All changes are committed and pushed to GitHub

### Database Connection Issues

- Ensure PostgreSQL database is created in Render
- Check that `DATABASE_URL` environment variable is set
- Verify database credentials are correct

### Static Files Issues

- Ensure `collectstatic` runs during build
- Check that `STATIC_ROOT` is set correctly in settings.py
- Verify WhiteNoise is configured (already in requirements.txt)

## Post-Deployment

After deployment:

1. Run migrations: `python manage.py migrate`
2. Create superuser: `python manage.py createsuperuser`
3. Verify health endpoint: `https://your-app.onrender.com/health/`
4. Access API docs: `https://your-app.onrender.com/api/docs/`

## Troubleshooting

### Build Fails with Pillow Error

**Problem**: `ERROR: Failed to build 'Pillow'`

**Solution**: 
- Ensure Python version is 3.12.7 (check `runtime.txt` and `.python-version`)
- Verify `Pillow==10.4.0` in `requirements.txt`
- Clear Render build cache and rebuild

### Python Version Mismatch

**Problem**: Render uses Python 3.13.4 instead of 3.12.7

**Solution**:
- Set `PYTHON_VERSION=3.12.7` environment variable in Render dashboard
- Verify `runtime.txt` contains `3.12.7`
- Verify `.python-version` file exists with `3.12.7`

### Node.js Version Issues

**Problem**: Wrong Node.js version

**Solution**:
- Set `NODE_VERSION=18.x` environment variable
- Verify `.nvmrc` file contains `18`
- Verify `package.json` engines specify `"node": "18.x"`

## Notes

- Render automatically provides `$PORT` environment variable
- Health check endpoint should be available at `/health/`
- Static files are served via WhiteNoise
- Database migrations should run automatically if configured in build command

